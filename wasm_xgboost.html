<!DOCTYPE html>
<html>
<head>
    <title>Game Player Rank Predictor</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        body {
            font-family: 'Arial, Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .header {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .header h1 {
            color: #00ff00;
            text-shadow: 0 0 10px rgba(0,255,0,0.5);
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 1800px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .button-group {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        button {
            padding: 12px 24px;
            cursor: pointer;
            background-color: #00ff00;
            color: #000000;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            transition: all 0.3s;
            text-transform: uppercase;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0,255,0,0.5);
        }
        button:hover {
            background-color: #00cc00;
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(0,255,0,0.7);
        }
        button:disabled {
            background-color: #333333;
            cursor: not-allowed;
            box-shadow: none;
        }
        #output {
            white-space: pre-wrap;
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            height: 500px;
            overflow-y: auto;
            border: 1px solid #00ff00;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #00ff00;
        }
        .visualization {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #00ff00;
        }
        .visualization img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }
        .input-group {
            margin: 20px 0;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            background-color: #2a2a2a;
            border: 1px solid #00ff00;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
            box-sizing: border-box;
            color: #00ff00;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #00ff00;
        }
        .panel {
            background-color: #2a2a2a;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,255,0,0.2);
            padding: 20px;
            border: 1px solid #00ff00;
        }
        .rank-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #333333;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ® Game Player Rank Predictor ğŸ®</h1>
        <p>ê²Œì„ í†µê³„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”Œë ˆì´ì–´ì˜ ì‹¤ë ¥ì„ ì˜ˆì¸¡í•˜ëŠ” AI ì‹œìŠ¤í…œ</p>

        <div class="button-group">
            <button onclick="initPyodide()" id="initButton">Initialize System</button>
            <button onclick="trainModel()" id="trainButton" disabled>Train AI Model</button>
            <button onclick="runInference()" id="inferenceButton" disabled>Predict Rank</button>
        </div>

        <div class="rank-info">
            <h3>ğŸ† ë­í¬ ì‹œìŠ¤í…œ</h3>
            <p>Bronze (0) â†’ Silver (1) â†’ Gold (2) â†’ Platinum (3) â†’ Diamond (4)</p>
        </div>
    </div>

    <div class="container">
        <div class="panel">
            <div class="input-group">
                <label for="inferenceInput">í”Œë ˆì´ì–´ ë°ì´í„° ì…ë ¥ (JSON format):</label>
                <textarea id="inferenceInput">[{
    "avg_kills": 15.5,
    "avg_deaths": 8.2,
    "avg_assists": 12.3,
    "win_rate": 0.52,
    "headshot_rate": 0.25,
    "avg_damage": 18500,
    "playtime_hours": 450
}]</textarea>
            </div>
            <div id="output">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
        <div class="panel">
            <div class="visualization">
                <h3>ğŸ¯ ë°ì´í„° ë¶„í¬ ì‹œê°í™”</h3>
                <img id="dataPlot" alt="Data distribution plot" style="width: 100%; display: none;">
            </div>
        </div>
    </div>

    <script>
        let pyodide = null;
        let modelTrained = false;
        const output = document.getElementById('output');

        function appendToOutput(text) {
            output.textContent += text;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            output.textContent = '';
        }

        async function initPyodide() {
            const initButton = document.getElementById('initButton');
            try {
                initButton.disabled = true;
                clearOutput();
                appendToOutput('ğŸ® ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...\n');

                pyodide = await loadPyodide({
                    stdout: (text) => appendToOutput(text + '\n'),
                    stderr: (text) => appendToOutput('âŒ Error: ' + text + '\n')
                });

                appendToOutput('ğŸ“¦ í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘...\n');
                await pyodide.loadPackage("micropip");
                const micropip = pyodide.pyimport("micropip");

                appendToOutput('ğŸ”§ AI ëª¨ë¸ ì¤€ë¹„ ì¤‘... (ì•½ 1-2ë¶„ ì†Œìš”)\n');
                await micropip.install(['scikit-learn', 'xgboost', 'matplotlib', 'pandas']);

                document.getElementById('trainButton').disabled = false;
                appendToOutput('\nâœ… ì´ˆê¸°í™” ì™„ë£Œ! Train AI Model ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ëª¨ë¸ì„ í•™ìŠµí•˜ì„¸ìš”.\n');
            } catch (error) {
                appendToOutput('\nâŒ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message + '\n');
                initButton.disabled = false;
                console.error('Initialization error:', error);
            }
        }

        async function trainModel() {
            const trainButton = document.getElementById('trainButton');
            try {
                trainButton.disabled = true;
                appendToOutput('\nğŸ® AI ëª¨ë¸ í•™ìŠµ ì‹œì‘...\n');

                const pythonCode = `
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.decomposition import PCA
import xgboost as xgb
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import base64
from io import BytesIO

print("ğŸ® ê²Œì„ ë°ì´í„° ìƒì„± ì¤‘...")
np.random.seed(42)
n_samples = 1000

# ê° ë­í¬ë³„ íŠ¹ì„± í‰ê· ê³¼ í‘œì¤€í¸ì°¨ ì •ì˜
rank_stats = {
    'Bronze': {
        'kills': (8, 3), 'deaths': (12, 3), 'assists': (5, 2),
        'win_rate': (0.35, 0.05), 'headshot': (0.15, 0.05),
        'damage': (12000, 2000), 'playtime': (100, 50)
    },
    'Silver': {
        'kills': (12, 3), 'deaths': (10, 2), 'assists': (8, 2),
        'win_rate': (0.45, 0.05), 'headshot': (0.2, 0.05),
        'damage': (15000, 2000), 'playtime': (200, 100)
    },
    'Gold': {
        'kills': (15, 3), 'deaths': (8, 2), 'assists': (10, 3),
        'win_rate': (0.52, 0.05), 'headshot': (0.25, 0.05),
        'damage': (18000, 2000), 'playtime': (400, 150)
    },
    'Platinum': {
        'kills': (18, 3), 'deaths': (6, 2), 'assists': (12, 3),
        'win_rate': (0.58, 0.05), 'headshot': (0.3, 0.05),
        'damage': (21000, 2000), 'playtime': (800, 200)
    },
    'Diamond': {
        'kills': (22, 3), 'deaths': (5, 2), 'assists': (15, 3),
        'win_rate': (0.65, 0.05), 'headshot': (0.35, 0.05),
        'damage': (25000, 2000), 'playtime': (1200, 300)
    }
}

# ë°ì´í„° ìƒì„± í•¨ìˆ˜
def generate_rank_data(rank_info, n_samples):
    return {
        'avg_kills': np.random.normal(rank_info['kills'][0], rank_info['kills'][1], n_samples),
        'avg_deaths': np.random.normal(rank_info['deaths'][0], rank_info['deaths'][1], n_samples),
        'avg_assists': np.random.normal(rank_info['assists'][0], rank_info['assists'][1], n_samples),
        'win_rate': np.clip(np.random.normal(rank_info['win_rate'][0], rank_info['win_rate'][1], n_samples), 0, 1),
        'headshot_rate': np.clip(np.random.normal(rank_info['headshot'][0], rank_info['headshot'][1], n_samples), 0, 1),
        'avg_damage': np.random.normal(rank_info['damage'][0], rank_info['damage'][1], n_samples),
        'playtime_hours': np.clip(np.random.normal(rank_info['playtime'][0], rank_info['playtime'][1], n_samples), 0, None)
    }

# ê° ë­í¬ë³„ ë°ì´í„° ìƒì„±
data_list = []
rank_names = ['Bronze', 'Silver', 'Gold', 'Platinum', 'Diamond']
samples_per_rank = n_samples // len(rank_names)

for rank_idx, rank in enumerate(rank_names):
    rank_data = generate_rank_data(rank_stats[rank], samples_per_rank)
    df_rank = pd.DataFrame(rank_data)
    df_rank['rank'] = rank_idx
    data_list.append(df_rank)

# ë°ì´í„° í•©ì¹˜ê¸°
df = pd.concat(data_list, ignore_index=True)

# ë°ì´í„° ë¶„í• 
X = df.drop('rank', axis=1)
y = df['rank']

print("ğŸ² í•™ìŠµ/í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶„í•  ì¤‘...")
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

print("ğŸ“Š ë°ì´í„° ì‹œê°í™” ì¤‘...")
pca = PCA(n_components=2)
X_pca = pca.fit_transform(X)

plt.figure(figsize=(12, 8))
scatter = plt.scatter(X_pca[:, 0], X_pca[:, 1], c=y, cmap='viridis', alpha=0.6)
plt.colorbar(scatter, label='Rank', ticks=range(5))

plt.title('Player Data Distribution (PCA)', fontsize=14, color='white')
plt.xlabel('First Principal Component', fontsize=12, color='white')
plt.ylabel('Second Principal Component', fontsize=12, color='white')
plt.grid(True, alpha=0.3)

# Set plot style for dark theme
plt.gca().set_facecolor('#2a2a2a')
plt.gcf().set_facecolor('#2a2a2a')
plt.gca().tick_params(colors='white')
for spine in plt.gca().spines.values():
    spine.set_color('white')

# Save plot to base64
buf = BytesIO()
plt.savefig(buf, format='png', dpi=100, bbox_inches='tight',
            facecolor='#2a2a2a', edgecolor='none')
buf.seek(0)
plot_base64 = base64.b64encode(buf.getvalue()).decode('utf-8')
plt.close()

print("ğŸ¯ XGBoost ëª¨ë¸ í•™ìŠµ ì¤‘...")
model = xgb.XGBClassifier(
    n_estimators=100,
    max_depth=3,
    random_state=42
)
model.fit(X_train, y_train)

print("ğŸ“ ì„±ëŠ¥ í‰ê°€ ì¤‘...")
y_pred = model.predict(X_test)
accuracy = (y_pred == y_test).mean()

print("âœ¨ í•™ìŠµ ì™„ë£Œ!")
print(f"ğŸ¯ í…ŒìŠ¤íŠ¸ ì„¸íŠ¸ ì •í™•ë„: {accuracy:.4f}")

globals()['trained_model'] = model
globals()['pca_transformer'] = pca
print("ğŸ® ì´ì œ 'Predict Rank' ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œìš´ í”Œë ˆì´ì–´ì˜ ë­í¬ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")

plot_base64
                `
                const base64Plot = await pyodide.runPythonAsync(pythonCode);
                document.getElementById('dataPlot').src = 'data:image/png;base64,' + base64Plot;
                document.getElementById('dataPlot').style.display = 'block';

                modelTrained = true;
                document.getElementById('inferenceButton').disabled = false;
            } catch (error) {
                appendToOutput('\nâŒ ëª¨ë¸ í•™ìŠµ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message + '\n');
                console.error('Training error:', error);
            } finally {
                trainButton.disabled = false;
            }
        }

        async function runInference() {
            const inferenceButton = document.getElementById('inferenceButton');
            const inferenceInput = document.getElementById('inferenceInput').value;

            try {
                inferenceButton.disabled = true;
                appendToOutput('\nğŸ¯ ë­í¬ ì˜ˆì¸¡ ì‹œì‘...\n');

                const pythonCode = `
import numpy as np
import json
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import base64
from io import BytesIO
import pandas as pd

print("í”Œë ˆì´ì–´ ë°ì´í„° ë¶„ì„ ì¤‘...")
input_data = json.loads('''${inferenceInput}''')
X_new = pd.DataFrame(input_data)

if 'trained_model' not in globals():
    raise Exception("AI ëª¨ë¸ì´ í•™ìŠµë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € 'Train AI Model'ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”.")

print("ë­í¬ ì˜ˆì¸¡ ì¤‘...")
predictions = trained_model.predict(X_new)
probabilities = trained_model.predict_proba(X_new)

# PCA ë³€í™˜ ë° ì‹œê°í™”
X_pca_new = pca_transformer.transform(X_new)

plt.figure(figsize=(12, 8))
plt.scatter(X_pca_new[:, 0], X_pca_new[:, 1],
           c='yellow', marker='*', s=300, label='New Player', zorder=5)
plt.title('Player Position in Ranking System', fontsize=14, color='white')
plt.xlabel('First Principal Component', fontsize=12, color='white')
plt.ylabel('Second Principal Component', fontsize=12, color='white')
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)

# ë‹¤í¬ í…Œë§ˆ ì„¤ì •
plt.gca().set_facecolor('#2a2a2a')
plt.gcf().set_facecolor('#2a2a2a')
plt.gca().tick_params(colors='white')
for spine in plt.gca().spines.values():
    spine.set_color('white')

buf = BytesIO()
plt.savefig(buf, format='png', dpi=100, bbox_inches='tight',
            facecolor='#2a2a2a', edgecolor='none')
buf.seek(0)
plot_base64 = base64.b64encode(buf.getvalue()).decode('utf-8')
plt.close()

rank_names = ['Bronze', 'Silver', 'Gold', 'Platinum', 'Diamond']
print("\\nì˜ˆì¸¡ ê²°ê³¼:")
print("-------------------")

for i, (pred, prob) in enumerate(zip(predictions, probabilities)):
    print(f"í”Œë ˆì´ì–´ {i+1}:")
    print(f"  ì˜ˆì¸¡ ë­í¬: {rank_names[pred]}")
    print("  ë­í¬ë³„ í™•ë¥ :")
    for rank, probability in zip(rank_names, prob):
        print(f"    {rank}: {probability:.2%}")

plot_base64
`
                const base64Plot = await pyodide.runPythonAsync(pythonCode);
                document.getElementById('dataPlot').src = 'data:image/png;base64,' + base64Plot;
            } catch (error) {
                appendToOutput('\nâŒ ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message + '\n');
                console.error('Inference error:', error);
            } finally {
                inferenceButton.disabled = false;
            }
        }
    </script>
</body>
</html>
